<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•è¯å¤§é—¯å…³</title>
    <style>
        /* é€šç”¨æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'å¾®è½¯é›…é»‘', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e0f7fa, #bbdefb);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        
        /* å°é¢é¡µæ ·å¼ */
        .cover-page {
            text-align: center;
        }
        
        .main-title {
            font-size: 3.5rem;
            color: #1565c0;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.5rem;
            color: #5d99c6;
            margin-bottom: 40px;
        }
        
        .game-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .game-option {
            width: 180px;
            height: 200px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .game-option:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .option-1 {
            background-color: #e1f5fe;
            border: 2px solid #81d4fa;
        }
        
        .option-2 {
            background-color: #fff9c4;
            border: 2px solid #fff176;
        }
        
        .option-3 {
            background-color: #e8f5e9;
            border: 2px solid #a5d6a7;
        }
        
        .option-4 {
            background-color: #f3e5f5;
            border: 2px solid #ce93d8;
        }
        
        .option-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .reset-btn {
            background-color: #ff7043;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 30px;
            transition: background-color 0.3s;
        }
        
        .reset-btn:hover {
            background-color: #f4511e;
        }
        
        /* å…³å¡é¡µé¢é€šç”¨æ ·å¼ */
        .game-page {
            display: none;
        }
        
        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .game-title {
            font-size: 2.5rem;
            color: #1565c0;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .game-subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .menu-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .menu-btn {
            padding: 8px 15px;
            border-radius: 20px;
            border: none;
            background-color: #42a5f5;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .menu-btn:hover {
            background-color: #1e88e5;
        }
        
        .timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: #e53935;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .game-area {
            background-color: #f5f5f5;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 300px;
        }
        
        /* ç¬¬ä¸€å…³æ ·å¼ - å•è¯æ‹¼æ‹¼çœ‹ */
        .mario-style {
            background: linear-gradient(to bottom, #8bc34a, #4caf50);
            border: 5px solid #795548;
            position: relative;
            overflow: hidden;
        }
        
        .mario-style::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: repeating-linear-gradient(
                45deg,
                #4caf50,
                #4caf50 10px,
                #388e3c 10px,
                #388e3c 20px
            );
        }
        
        .hint-area {
            background-color: white;
            border: 3px solid #f44336;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2rem;
            position: relative;
        }
        
        .hint-area::after {
            content: "";
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 15px solid #f44336;
        }
        
        .letters-area {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .letter-block {
            width: 50px;
            height: 50px;
            background-color: #ff9800;
            border: 3px solid #e65100;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .letter-block:hover {
            background-color: #ffb74d;
            transform: scale(1.1);
        }
        
        .spelling-area {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .empty-slot {
            width: 50px;
            height: 50px;
            background-color: #ffeb3b;
            border: 3px dashed #fbc02d;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
        }
        
        .action-btn {
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .confirm-btn {
            background-color: #4caf50;
        }
        
        .clear-btn {
            background-color: #f44336;
        }
        
        .action-btn:hover {
            transform: scale(1.05);
        }
        
        .correct-word-hint {
            text-align: center;
            color: red;
            font-weight: bold;
            margin-top: 10px;
            font-size: 1.2rem;
        }
        
        /* ç¬¬ä¸‰å…³æ ·å¼ - è¯­å¢ƒèƒŒå•è¯ */
        .story-area {
            background-color: #fff8e1;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        
        .blank-input {
            display: inline-block;
            width: 100px;
            height: 35px;
            border: 2px dashed #ff9800;
            border-radius: 5px;
            margin: 0 5px;
            vertical-align: middle;
            text-align: center;
            cursor: pointer;
            background-color: #fff3e0;
        }
        
        .blank-input.filled {
            border: 2px solid #ff9800;
            background-color: #ffe0b2;
        }
        
        .input-area {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .word-input {
            padding: 10px 15px;
            border: 2px solid #42a5f5;
            border-radius: 20px;
            font-size: 1rem;
            width: 200px;
        }
        
        .check-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .story-complete-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        /* ç¬¬å››å…³æ ·å¼ - å¥å­æ±‰è¯‘è‹± */
        .translation-area {
            background-color: #e3f2fd;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 1.2rem;
            text-align: center;
        }
        
        .chinese-sentence {
            font-size: 1.4rem;
            color: #1565c0;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .hint-words {
            background-color: #bbdefb;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-style: italic;
        }
        
        .translation-input {
            width: 80%;
            padding: 12px 20px;
            border: 2px solid #42a5f5;
            border-radius: 10px;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .translation-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .result-area {
            text-align: center;
            margin-top: 20px;
            min-height: 50px;
        }
        
        .correct-translation {
            color: #4caf50;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .incorrect-translation {
            color: #f44336;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        /* ç»“æŸé¡µæ ·å¼ */
        .final-page {
            text-align: center;
        }
        
        .well-done {
            font-size: 4rem;
            color: #ff9800;
            margin: 20px 0;
        }
        
        .score-display {
            font-size: 2rem;
            color: #1565c0;
            margin: 30px 0;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-options {
                flex-direction: column;
                align-items: center;
            }
            
            .game-option {
                width: 90%;
                max-width: 250px;
            }
            
            .menu-bar {
                flex-direction: column;
                align-items: center;
            }
            
            .translation-input {
                width: 95%;
            }
        }
        
        /* ç‰¹æ•ˆæ ·å¼ */
        @keyframes coin {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .coin-animation {
            animation: coin 0.5s ease-in-out;
            color: gold;
        }
        
        .correct {
            background-color: #c8e6c9 !important;
        }
        
        .incorrect {
            background-color: #ffcdd2 !important;
        }
        
        .highlight {
            animation: highlight 0.5s ease-in-out 3;
        }
        
        @keyframes highlight {
            0% { background-color: initial; }
            50% { background-color: #c8e6c9; }
            100% { background-color: initial; }
        }
        
        /* ç¬¬äºŒå…³æ ·å¼ - å•è¯æŠ“å¤§é¹… */
        #game-2 * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', 'æ¥·ä½“', sans-serif;
        }
        
        #game-2 .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        #game-2 .header {
            background-color: #b8d8f0;
            border: 3px dashed #8bb9e8;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        
        #game-2 .title {
            font-size: 2.5rem;
            color: #6a5acd;
            margin-bottom: 10px;
        }
        
        #game-2 .subtitle {
            font-size: 1.2rem;
            color: #7a6baa;
        }
        
        #game-2 .menu {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            background-color: #e6f2ff;
            padding: 15px;
            border-radius: 15px;
            justify-content: space-between;
            align-items: center;
        }
        
        #game-2 .menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #game-2 .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #game-2 .speed-slider {
            width: 150px;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
        }
        
        #game-2 .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #6a5acd;
            cursor: pointer;
        }
        
        #game-2 button {
            background-color: #b19cd9;
            border: none;
            border-radius: 10px;
            color: white;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        #game-2 button:hover {
            background-color: #9370db;
            transform: translateY(-2px);
        }
        
        #game-2 .timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: #6a5acd;
            margin-bottom: 20px;
            text-align: center;
        }
        
        #game-2 .game-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        #game-2 .word-panel {
            position: relative;
            background-color: #e6f7ff;
            border: 2px dashed #b8d8f0;
            border-radius: 15px;
            height: 300px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        #game-2 .word-box {
            position: absolute;
            background-color: white;
            border: 2px solid #b19cd9;
            border-radius: 10px;
            padding: 8px 15px;
            font-size: 1.2rem;
            cursor: grab;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            z-index: 10;
        }
        
        #game-2 .word-box.dragging {
            cursor: grabbing;
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        #game-2 .geese-area {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }
        
        #game-2 .goose-box {
            flex: 1;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
        }
        
        #game-2 .goose-box.purple {
            background-color: #e6e6fa;
        }
        
        #game-2 .goose-box.yellow {
            background-color: #fffacd;
        }
        
        #game-2 .goose-box.blue {
            background-color: #e0ffff;
        }
        
        #game-2 .goose-image {
            width: 80px;
            height: 80px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        #game-2 .meaning {
            font-size: 1.1rem;
            color: white;
            background-color: rgba(106, 90, 205, 0.7);
            padding: 8px 12px;
            border-radius: 8px;
            width: 100%;
        }
        
        #game-2 .goose-box.correct {
            animation: correct 0.5s;
        }
        
        #game-2 .goose-box.wrong {
            animation: wrong 0.5s;
        }
        
        #game-2 .goose-box.highlight {
            animation: highlight 1.5s;
        }
        
        @keyframes correct {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes wrong {
            0% { background-color: #e6e6fa; }
            50% { background-color: #ffcccc; }
            100% { background-color: #e6e6fa; }
        }
        
        #game-2 .firework {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
        }
        
        #game-2 .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        #game-2 .modal-content {
            background-color: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        #game-2 .modal h2 {
            color: #6a5acd;
            margin-bottom: 15px;
        }
        
        #game-2 .modal p {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }
        
        #game-2 .stacked-word {
            position: absolute;
            bottom: 0;
            background-color: white;
            border: 2px solid #b19cd9;
            border-radius: 10px;
            padding: 8px 15px;
            font-size: 1.2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        #game-2 .waiting-indicator {
            text-align: center;
            padding: 10px;
            color: #6a5acd;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- å°é¢é¡µ -->
    <div id="cover-page" class="container cover-page">
        <h1 class="main-title">å•è¯å¤§é—¯å…³</h1>
        <p class="subtitle">è¶£å‘³å­¦å•è¯ï¼</p>
        
        <div class="game-options">
            <div class="game-option option-1" onclick="startGame(1)">
                <div class="option-title">å•è¯æ‹¼æ‹¼çœ‹</div>
                <div class="option-icon">ğŸ„</div>
            </div>
            <div class="game-option option-2" onclick="startGame(2)">
                <div class="option-title">å•è¯æŠ“å¤§é¹…</div>
                <div class="option-icon">ğŸ¦¢</div>
            </div>
            <div class="game-option option-3" onclick="startGame(3)">
                <div class="option-title">è¯­å¢ƒèƒŒå•è¯</div>
                <div class="option-icon">ğŸ“š</div>
            </div>
            <div class="game-option option-4" onclick="startGame(4)">
                <div class="option-title">å¥å­æ±‰è¯‘è‹±</div>
                <div class="option-icon">ğŸŒ</div>
            </div>
        </div>
        
        <button class="reset-btn" onclick="resetProgress()">é‡ç½®è¿›åº¦</button>
    </div>
    
    <!-- ç¬¬ä¸€å…³ï¼šå•è¯æ‹¼æ‹¼çœ‹ -->
    <div id="game-1" class="container game-page">
        <div class="game-header">
            <h2 class="game-title">å•è¯æ‹¼æ‹¼çœ‹ï¼ˆé©¬é‡Œå¥¥ç‰ˆï¼‰</h2>
            <p class="game-subtitle">æ‹¼å‡ºæ­£ç¡®å•è¯ï¼Œå¸®é©¬é‡Œå¥¥é€šå…³ï¼</p>
        </div>
        
        <div class="menu-bar">
            <input type="file" id="word-file-1" accept=".csv" style="display: none;">
            <button class="menu-btn" onclick="document.getElementById('word-file-1').click()">å¯¼å…¥å•è¯è¡¨</button>
            <div>
                <label>éš¾åº¦ï¼š</label>
                <select id="difficulty">
                    <option value="easy">ç®€å•ï¼ˆ6å­—æ¯åŠä»¥å†…ï¼‰</option>
                    <option value="hard">å›°éš¾ï¼ˆ7å­—æ¯åŠä»¥ä¸Šï¼‰</option>
                </select>
            </div>
            <button class="menu-btn" id="start-btn-1" onclick="startSpellingGame()">å¼€å§‹æ¸¸æˆ</button>
            <div class="timer">ç”¨æ—¶ï¼š<span id="timer-1">0</span>ç§’</div>
        </div>
        
        <div class="game-area mario-style">
            <div class="hint-area" id="hint-area">
                æç¤ºï¼šè¯·å…ˆä¸Šä¼ å•è¯è¡¨å¹¶å¼€å§‹æ¸¸æˆ
            </div>
            
            <div class="letters-area" id="letters-area">
                <!-- å­—æ¯å—å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="spelling-area" id="spelling-area">
                <!-- æ‹¼å†™åŒºåŸŸå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="action-buttons">
                <button class="action-btn confirm-btn" onclick="checkSpelling()">ç¡®è®¤æ‹¼å†™</button>
                <button class="action-btn clear-btn" onclick="clearCurrent()">æ¸…é™¤å½“å‰</button>
            </div>
            
            <div class="correct-word-hint" id="correct-word-hint" style="display: none;"></div>
        </div>
        
        <button class="menu-btn" onclick="backToCover()">è¿”å›å°é¢</button>
    </div>
    
    <!-- ç¬¬äºŒå…³ï¼šå•è¯æŠ“å¤§é¹… -->
    <div id="game-2" class="container game-page">
        <div class="header">
            <h1 class="title" id="gameTitle">å•è¯æŠ“å¤§é¹…</h1>
            <p class="subtitle">æŠŠæ­£ç¡®çš„å•è¯æ‹–åˆ°å¤§é¹…çš„ç¯®å­é‡Œå§ï¼</p>
        </div>
        
        <div class="menu">
            <div class="menu-item">
                <span>é€Ÿåº¦ï¼š</span>
                <div class="speed-control">
                    <span>æ™®é€š</span>
                    <input type="range" min="1" max="3" value="1" class="speed-slider" id="speedSlider">
                    <span>å¿«é€Ÿ</span>
                </div>
            </div>
            
            <div class="menu-item">
                <input type="file" id="wordFile" accept=".csv" style="display: none;">
                <button id="importBtn">å¯¼å…¥å•è¯è¡¨</button>
            </div>
            
            <div class="menu-item">
                <button id="startBtn">å¼€å§‹æ¸¸æˆ</button>
            </div>
            
            <div class="menu-item">
                <button id="pauseBtn">æš‚åœ</button>
            </div>
            
            <div class="menu-item">
                <button id="exitBtn">é€€å‡º</button>
            </div>
        </div>
        
        <div class="timer" id="timer">è€—æ—¶ï¼š0ç§’</div>
        
        <div class="game-area">
            <div class="word-panel" id="wordPanel">
                <!-- å•è¯æ–¹å—å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                <div class="waiting-indicator" id="waitingIndicator" style="display: none;">
                    ç­‰å¾…ç”¨æˆ·å¤„ç†å½“å‰å•è¯...
                </div>
            </div>
            
            <div class="geese-area" id="geeseArea">
                <div class="goose-box purple" data-index="0">
                    <div class="goose-image">ğŸ¦¢</div>
                    <div class="meaning" id="meaning0">ç­‰å¾…å¯¼å…¥...</div>
                </div>
                <div class="goose-box yellow" data-index="1">
                    <div class="goose-image">ğŸ¦¢</div>
                    <div class="meaning" id="meaning1">ç­‰å¾…å¯¼å…¥...</div>
                </div>
                <div class="goose-box blue" data-index="2">
                    <div class="goose-image">ğŸ¦¢</div>
                    <div class="meaning" id="meaning2">ç­‰å¾…å¯¼å…¥...</div>
                </div>
            </div>
        </div>
        
        <button class="menu-btn" onclick="backToCover()" style="margin-top: 20px;">è¿”å›å°é¢</button>
    </div>
    
    <!-- ç¬¬ä¸‰å…³ï¼šè¯­å¢ƒèƒŒå•è¯ -->
    <div id="game-3" class="container game-page">
        <div class="game-header">
            <h2 class="game-title">è¯­å¢ƒèƒŒå•è¯</h2>
            <p class="game-subtitle">è¯·ç”¨ä½ æ–‡ä»¶ä¸­çš„å•è¯æ¥å®Œæˆå¡«ç©ºå§ï¼</p>
        </div>
        
        <div class="menu-bar">
            <button class="menu-btn" onclick="startStoryGame()">å¼€å§‹æŒ‘æˆ˜</button>
            <div class="timer">ç”¨æ—¶ï¼š<span id="timer-3">0</span>ç§’</div>
        </div>
        
        <div class="game-area">
            <div class="story-area" id="story-area">
                ç‚¹å‡»"å¼€å§‹æŒ‘æˆ˜"æŒ‰é’®ï¼ŒéšæœºåŠ è½½ä¸€ç¯‡æ•…äº‹ï¼Œå¹¶ç”¨æ­£ç¡®çš„å•è¯å®Œæˆå¡«ç©ºã€‚
            </div>
            
            <div class="input-area">
                <input type="text" class="word-input" id="word-input" placeholder="è¯·è¾“å…¥å•è¯">
                <button class="menu-btn" onclick="fillBlank()">ç¡®è®¤å¡«å…¥</button>
            </div>
            
            <div class="check-buttons">
                <button class="menu-btn" onclick="checkAnswers()">æ£€æŸ¥ç­”æ¡ˆ</button>
                <button class="menu-btn" onclick="resetCurrent()">é‡ç½®å½“å‰</button>
            </div>
            
            <div class="story-complete-buttons" id="story-complete-buttons" style="display: none;">
                <button class="menu-btn" onclick="nextStory()">ä¸‹ä¸€ç¯‡æ•…äº‹</button>
                <button class="menu-btn" onclick="goToFinalPage()">è¿›å…¥ç»“ç®—é¡µ</button>
            </div>
        </div>
        
        <button class="menu-btn" onclick="backToCover()">è¿”å›å°é¢</button>
    </div>
    
    <!-- ç¬¬å››å…³ï¼šå¥å­æ±‰è¯‘è‹± -->
    <div id="game-4" class="container game-page">
        <div class="game-header">
            <h2 class="game-title">å¥å­æ±‰è¯‘è‹±</h2>
            <p class="game-subtitle">å°†ä¸­æ–‡å¥å­ç¿»è¯‘æˆè‹±æ–‡å§ï¼</p>
        </div>
        
        <div class="menu-bar">
            <button class="menu-btn" onclick="startTranslationGame()">å¼€å§‹æŒ‘æˆ˜</button>
            <div class="timer">ç”¨æ—¶ï¼š<span id="timer-4">0</span>ç§’</div>
        </div>
        
        <div class="game-area">
            <div class="translation-area">
                <div class="chinese-sentence" id="chinese-sentence">
                    è¯·ç‚¹å‡»"å¼€å§‹æŒ‘æˆ˜"æŒ‰é’®å¼€å§‹æ¸¸æˆ
                </div>
                <div class="hint-words" id="hint-words">
                    æç¤ºè¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ
                </div>
                <input type="text" class="translation-input" id="translation-input" placeholder="è¯·è¾“å…¥è‹±æ–‡ç¿»è¯‘">
                <div class="translation-buttons">
                    <button class="action-btn confirm-btn" onclick="checkTranslation()">æ£€æŸ¥ç­”æ¡ˆ</button>
                    <button class="action-btn clear-btn" onclick="clearTranslation()">æ¸…é™¤</button>
                    <button class="menu-btn" onclick="skipSentence()">è·³è¿‡</button>
                </div>
                <div class="result-area" id="result-area"></div>
            </div>
        </div>
        
        <button class="menu-btn" onclick="backToCover()">è¿”å›å°é¢</button>
    </div>
    
    <!-- ç»“æŸé¡µ -->
    <div id="final-page" class="container final-page game-page">
        <h1 class="well-done">Well Doneï¼</h1>
        <p class="score-display">å¤ªæ£’äº†ï¼ä½ æ€»å…±è·å¾—äº†ï¼ˆ<span id="total-score">0</span>ï¼‰åˆ†ï¼</p>
        <button class="reset-btn" onclick="backToCover()">å›åˆ°å°é¢é¡µ</button>
    </div>

    <!-- ç¬¬äºŒå…³æ¨¡æ€æ¡† -->
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h2>æ­å–œå®Œæˆï¼</h2>
            <p id="resultText">ä½ ç”¨äº† <span id="timeUsed">0</span> ç§’å®Œæˆäº†è¿™ä¸€è½®ï¼</p>
            <button id="continueBtn">ç»§ç»­æŒ‘æˆ˜</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€ç®¡ç†
        let currentPage = 'cover-page';
        let gameScores = {
            game1: 0,
            game2: 0,
            game3: 0,
            game4: 0
        };
        
        // æ˜¾ç¤ºæŒ‡å®šé¡µé¢ï¼Œéšè—å…¶ä»–é¡µé¢
        function showPage(pageId) {
            document.querySelectorAll('.game-page').forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById(pageId).style.display = 'block';
            currentPage = pageId;
        }
        
        // å¼€å§‹æ¸¸æˆ - è·³è½¬åˆ°å¯¹åº”å…³å¡
        function startGame(gameNumber) {
            showPage(`game-${gameNumber}`);
            
            // æ›´æ–°è¿›åº¦
            updateProgress(gameNumber);
        }
        
        // è¿”å›å°é¢é¡µ
        function backToCover() {
            showPage('cover-page');
        }
        
        // é‡ç½®è¿›åº¦
        function resetProgress() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ¸¸æˆè¿›åº¦å—ï¼Ÿ')) {
                localStorage.removeItem('wordGameProgress');
                localStorage.removeItem('wordGameScores');
                localStorage.removeItem('wordList1');
                localStorage.removeItem('wordList2');
                localStorage.removeItem('usedWords1');
                localStorage.removeItem('usedWords2');
                localStorage.removeItem('completedStories');
                localStorage.removeItem('wordGooseTitle');
                localStorage.removeItem('wordGooseWordList');
                localStorage.removeItem('usedSentences');
                gameScores = {game1: 0, game2: 0, game3: 0, game4: 0};
                alert('è¿›åº¦å·²é‡ç½®ï¼');
            }
        }
        
        // æ›´æ–°æ¸¸æˆè¿›åº¦
        function updateProgress(gameNumber) {
            let progress = JSON.parse(localStorage.getItem('wordGameProgress') || '{}');
            progress[`game${gameNumber}`] = true;
            localStorage.setItem('wordGameProgress', JSON.stringify(progress));
        }
        
        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å…³å¡éƒ½å·²å®Œæˆ
        function checkAllGamesCompleted() {
            let progress = JSON.parse(localStorage.getItem('wordGameProgress') || '{}');
            if (progress.game1 && progress.game2 && progress.game3 && progress.game4) {
                // è®¡ç®—æ€»åˆ†
                let totalScore = gameScores.game1 + gameScores.game2 + gameScores.game3 + gameScores.game4;
                document.getElementById('total-score').textContent = totalScore;
                showPage('final-page');
            }
        }
        
        // ç¬¬ä¸€å…³æ¸¸æˆé€»è¾‘
        let spellingTimer;
        let spellingSeconds = 0;
        let currentWord = '';
        let currentMeaning = '';
        let wordList1 = [];
        let usedWords1 = [];
        
        // å¯¼å…¥å•è¯è¡¨
        document.getElementById('word-file-1').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const lines = content.split('\n');
                wordList1 = [];
                
                lines.forEach(line => {
                    if (line.trim()) {
                        const parts = line.split(',');
                        if (parts.length >= 2) {
                            const word = parts[0].trim();
                            const meaning = parts[1].trim();
                            if (word && meaning) {
                                wordList1.push({word, meaning});
                            }
                        }
                    }
                });
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('wordList1', JSON.stringify(wordList1));
                alert(`æˆåŠŸå¯¼å…¥ ${wordList1.length} ä¸ªå•è¯ï¼`);
            };
            reader.readAsText(file);
        });
        
        function startSpellingGame() {
            // æ£€æŸ¥æ˜¯å¦æœ‰å•è¯è¡¨
            const savedWordList = localStorage.getItem('wordList1');
            if (!savedWordList || JSON.parse(savedWordList).length === 0) {
                alert('è¯·å…ˆä¸Šä¼ å•è¯è¡¨ï¼');
                return;
            }
            
            wordList1 = JSON.parse(savedWordList);
            usedWords1 = JSON.parse(localStorage.getItem('usedWords1') || '[]');
            
            // å¼€å§‹è®¡æ—¶
            spellingSeconds = 0;
            clearInterval(spellingTimer);
            spellingTimer = setInterval(() => {
                spellingSeconds++;
                document.getElementById('timer-1').textContent = spellingSeconds;
            }, 1000);
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            document.getElementById('start-btn-1').textContent = 'é‡æ–°å¼€å§‹';
            
            // éšè—æ­£ç¡®ç­”æ¡ˆæç¤º
            document.getElementById('correct-word-hint').style.display = 'none';
            
            // å¼€å§‹æ–°å•è¯
            startNewWord();
        }
        
        function startNewWord() {
            // è¿‡æ»¤å·²ä½¿ç”¨çš„å•è¯
            const availableWords = wordList1.filter(item => !usedWords1.includes(item.word));
            
            if (availableWords.length === 0) {
                alert('æ‰€æœ‰å•è¯éƒ½å·²ä½¿ç”¨ï¼é‡ç½®è¿›åº¦ä»¥é‡æ–°å¼€å§‹ã€‚');
                clearInterval(spellingTimer);
                return;
            }
            
            // æ ¹æ®éš¾åº¦ç­›é€‰å•è¯
            const difficulty = document.getElementById('difficulty').value;
            let filteredWords = availableWords;
            
            if (difficulty === 'easy') {
                filteredWords = availableWords.filter(item => item.word.length <= 6);
            } else if (difficulty === 'hard') {
                filteredWords = availableWords.filter(item => item.word.length >= 7);
            }
            
            if (filteredWords.length === 0) {
                alert('æ²¡æœ‰ç¬¦åˆå½“å‰éš¾åº¦è¦æ±‚çš„å•è¯ï¼');
                return;
            }
            
            // éšæœºé€‰æ‹©ä¸€ä¸ªå•è¯
            const randomIndex = Math.floor(Math.random() * filteredWords.length);
            const selected = filteredWords[randomIndex];
            currentWord = selected.word.toLowerCase();
            currentMeaning = selected.meaning;
            
            // æ›´æ–°æç¤ºåŒºåŸŸ
            document.getElementById('hint-area').textContent = `æç¤ºï¼š${currentMeaning}`;
            
            // éšè—æ­£ç¡®ç­”æ¡ˆæç¤º
            document.getElementById('correct-word-hint').style.display = 'none';
            
            // ç”Ÿæˆå­—æ¯å—
            generateLetterBlocks();
            
            // ç”Ÿæˆæ‹¼å†™åŒºåŸŸ
            generateSpellingSlots();
        }
        
        function generateLetterBlocks() {
            const lettersArea = document.getElementById('letters-area');
            lettersArea.innerHTML = '';
            
            // å½“å‰å•è¯çš„å­—æ¯ + 2-3ä¸ªå¹²æ‰°å­—æ¯
            let letters = currentWord.split('');
            const disturbLetters = ['x', 'z', 'q', 'j', 'k'];
            
            // æ·»åŠ å¹²æ‰°å­—æ¯
            const disturbCount = 2 + Math.floor(Math.random() * 2); // 2-3ä¸ª
            for (let i = 0; i < disturbCount; i++) {
                const randomDisturb = disturbLetters[Math.floor(Math.random() * disturbLetters.length)];
                if (!letters.includes(randomDisturb)) {
                    letters.push(randomDisturb);
                }
            }
            
            // æ‰“ä¹±å­—æ¯é¡ºåº
            letters = shuffleArray(letters);
            
            // åˆ›å»ºå­—æ¯å—
            letters.forEach(letter => {
                const block = document.createElement('div');
                block.className = 'letter-block';
                block.textContent = letter.toUpperCase();
                block.onclick = () => selectLetter(letter);
                lettersArea.appendChild(block);
            });
        }
        
        function generateSpellingSlots() {
            const spellingArea = document.getElementById('spelling-area');
            spellingArea.innerHTML = '';
            
            for (let i = 0; i < currentWord.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'empty-slot';
                slot.id = `slot-${i}`;
                spellingArea.appendChild(slot);
            }
        }
        
        function selectLetter(letter) {
            // æ‰¾åˆ°ç¬¬ä¸€ä¸ªç©ºæ§½å¹¶å¡«å…¥å­—æ¯
            for (let i = 0; i < currentWord.length; i++) {
                const slot = document.getElementById(`slot-${i}`);
                if (slot.textContent === '') {
                    slot.textContent = letter.toUpperCase();
                    slot.classList.add('filled');
                    break;
                }
            }
        }
        
        function clearCurrent() {
            // æ¸…é™¤æœ€åä¸€ä¸ªå¡«å…¥çš„å­—æ¯
            for (let i = currentWord.length - 1; i >= 0; i--) {
                const slot = document.getElementById(`slot-${i}`);
                if (slot.textContent !== '') {
                    slot.textContent = '';
                    slot.classList.remove('filled');
                    break;
                }
            }
        }
        
        function checkSpelling() {
            // æ”¶é›†æ‹¼å†™åŒºåŸŸä¸­çš„å­—æ¯
            let spelledWord = '';
            for (let i = 0; i < currentWord.length; i++) {
                const slot = document.getElementById(`slot-${i}`);
                spelledWord += slot.textContent.toLowerCase();
            }
            
            // æ£€æŸ¥æ‹¼å†™æ˜¯å¦æ­£ç¡®
            if (spelledWord === currentWord) {
                // æ­£ç¡® - æ˜¾ç¤ºé‡‘å¸åŠ¨ç”»
                const hintArea = document.getElementById('hint-area');
                hintArea.classList.add('coin-animation');
                setTimeout(() => {
                    hintArea.classList.remove('coin-animation');
                }, 500);
                
                // æ›´æ–°åˆ†æ•°
                gameScores.game1 += 10;
                localStorage.setItem('wordGameScores', JSON.stringify(gameScores));
                
                // æ ‡è®°å•è¯ä¸ºå·²ä½¿ç”¨
                usedWords1.push(currentWord);
                localStorage.setItem('usedWords1', JSON.stringify(usedWords1));
                
                // éšè—æ­£ç¡®ç­”æ¡ˆæç¤º
                document.getElementById('correct-word-hint').style.display = 'none';
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆä¸€è½®ï¼ˆ5ä¸ªå•è¯ï¼‰
                if (usedWords1.length % 5 === 0) {
                    setTimeout(() => {
                        alert(`æ­å–œï¼ä½ å·²å®Œæˆä¸€è½®ï¼ˆ5ä¸ªå•è¯ï¼‰ï¼ç”¨æ—¶ï¼š${spellingSeconds}ç§’`);
                    }, 1000);
                }
                
                // è¿›å…¥ä¸‹ä¸€ä¸ªå•è¯
                setTimeout(() => {
                    startNewWord();
                }, 1000);
            } else {
                // é”™è¯¯ - ç›´æ¥æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                document.getElementById('correct-word-hint').textContent = `æ­£ç¡®ç­”æ¡ˆ: ${currentWord}`;
                document.getElementById('correct-word-hint').style.display = 'block';
                
                // æ˜¾ç¤ºçº¢è‰²å‰å·
                const spellingArea = document.getElementById('spelling-area');
                spellingArea.style.color = 'red';
                setTimeout(() => {
                    spellingArea.style.color = '';
                }, 500);
                alert('å†è¯•ä¸€æ¬¡ï¼');
            }
        }
        
        // ç¬¬ä¸‰å…³æ¸¸æˆé€»è¾‘
        let storyTimer;
        let storySeconds = 0;
        let selectedBlankIndex = -1;
        let currentStory = null;
        let completedStories = [];
        
        // é¢„è®¾æ•…äº‹
        const stories = [
            {
                title: "Morning in the Park",
                content: "When I walked into the park at dawn, the ã€ã€‘ wind brushed my faceâ€”there were ã€ã€‘ trees on both sides of the path, and birds chirped to welcome the new day. I sat on a bench to watch the sunrise: the sky turned pink first, then orange, and the ã€ã€‘ from the small hill was amazing. A kid ran past me, laughing, and his mom ã€ã€‘ him to slow down. Later, I met my neighbor, and we ã€ã€‘ stories about our weekend ã€ã€‘â€”she'd visited a ã€ã€‘ town, while I'd stayed to enjoy this quiet morning.",
                blanks: [
                    { word: "gentle", meaning: "æ¸©å’Œçš„" },
                    { word: "dense", meaning: "èŒ‚å¯†çš„" },
                    { word: "view", meaning: "æ™¯è‰²" },
                    { word: "encouraged", meaning: "é¼“åŠ±" },
                    { word: "shared", meaning: "åˆ†äº«" },
                    { word: "journey", meaning: "æ—…è¡Œ" },
                    { word: "coastal", meaning: "æ²¿æµ·çš„" }
                ]
            },
            {
                title: "Class Volunteer Task",
                content: "Our class ã€ã€‘ a volunteer task to help the nursing home: we brought flowers, ã€ã€‘ the lobby with streamers, and ã€ã€‘ with the eldersâ€”one grandma ã€ã€‘ the handmade card I gave her, saying it brought her great ã€ã€‘. We helped ã€ã€‘ their bookshelves, and an old grandpa taught us to fold paper cranes; he said small acts have big ã€ã€‘, and we felt proud to make them happy.",
                blanks: [
                    { word: "launched", meaning: "å‘èµ·" },
                    { word: "decorated", meaning: "è£…é¥°" },
                    { word: "communicated", meaning: "äº¤æµ" },
                    { word: "cherished", meaning: "çæƒœ" },
                    { word: "joy", meaning: "å–œæ‚¦" },
                    { word: "arrange", meaning: "æ•´ç†" },
                    { word: "value", meaning: "ä»·å€¼" }
                ]
            },
            {
                title: "Surprise Birthday",
                content: "We kept Lucy's birthday party a ã€ã€‘: we ã€ã€‘ balloons, booked her favorite cafÃ©, and ã€ã€‘ all her friends to ã€ã€‘ early. When she walked in, she was ã€ã€‘ shockedâ€”we sang, she blew candles, and ã€ã€‘ the cake. We took photos to ã€ã€‘ the moment, and she ã€ã€‘ to plan a surprise for me too; this small party made our ã€ã€‘ even stronger.",
                blanks: [
                    { word: "secret", meaning: "ç§˜å¯†" },
                    { word: "prepared", meaning: "å‡†å¤‡" },
                    { word: "invited", meaning: "é‚€è¯·" },
                    { word: "decorate", meaning: "è£…é¥°" },
                    { word: "completely", meaning: "å®Œå…¨åœ°" },
                    { word: "shared", meaning: "åˆ†äº«" },
                    { word: "record", meaning: "è®°å½•" },
                    { word: "promised", meaning: "æ‰¿è¯º" },
                    { word: "friendship", meaning: "å‹è°Š" }
                ]
            }
        ];
        
        function startStoryGame() {
            // å¼€å§‹è®¡æ—¶
            storySeconds = 0;
            clearInterval(storyTimer);
            storyTimer = setInterval(() => {
                storySeconds++;
                document.getElementById('timer-3').textContent = storySeconds;
            }, 1000);
            
            // éšè—å®ŒæˆæŒ‰é’®
            document.getElementById('story-complete-buttons').style.display = 'none';
            
            // åŠ è½½éšæœºæ•…äº‹
            loadRandomStory();
        }
        
        function loadRandomStory() {
            // è·å–å·²å®Œæˆçš„æ•…äº‹
            completedStories = JSON.parse(localStorage.getItem('completedStories') || '[]');
            
            // è¿‡æ»¤æœªå®Œæˆçš„æ•…äº‹
            const availableStories = stories.filter(story => !completedStories.includes(story.title));
            
            if (availableStories.length === 0) {
                alert('æ‰€æœ‰æ•…äº‹éƒ½å·²å®Œæˆï¼é‡ç½®è¿›åº¦ä»¥é‡æ–°å¼€å§‹ã€‚');
                clearInterval(storyTimer);
                return;
            }
            
            // éšæœºé€‰æ‹©ä¸€ä¸ªæ•…äº‹
            const randomIndex = Math.floor(Math.random() * availableStories.length);
            currentStory = availableStories[randomIndex];
            
            const storyArea = document.getElementById('story-area');
            storyArea.innerHTML = '';
            
            // å°†æ•…äº‹æ–‡æœ¬åˆ†å‰²å¹¶åˆ›å»ºç©ºç™½è¾“å…¥æ¡†
            const parts = currentStory.content.split('ã€ã€‘');
            parts.forEach((part, index) => {
                const textNode = document.createTextNode(part);
                storyArea.appendChild(textNode);
                
                if (index < parts.length - 1) {
                    const blank = document.createElement('span');
                    blank.className = 'blank-input';
                    blank.id = `blank-${index}`;
                    blank.onclick = () => selectBlank(index);
                    storyArea.appendChild(blank);
                }
            });
        }
        
        function selectBlank(index) {
            selectedBlankIndex = index;
            
            // é«˜äº®é€‰ä¸­çš„ç©ºç™½
            document.querySelectorAll('.blank-input').forEach(blank => {
                blank.style.borderColor = '#ff9800';
            });
            document.getElementById(`blank-${index}`).style.borderColor = '#1565c0';
        }
        
        function fillBlank() {
            if (selectedBlankIndex === -1) {
                alert('è¯·å…ˆç‚¹å‡»è¦å¡«å†™çš„ç©ºç™½å¤„ï¼');
                return;
            }
            
            const word = document.getElementById('word-input').value.trim();
            if (!word) {
                alert('è¯·è¾“å…¥å•è¯ï¼');
                return;
            }
            
            const blank = document.getElementById(`blank-${selectedBlankIndex}`);
            blank.textContent = word;
            blank.classList.add('filled');
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('word-input').value = '';
        }
        
        function checkAnswers() {
            if (!currentStory) {
                alert('è¯·å…ˆå¼€å§‹æŒ‘æˆ˜ï¼');
                return;
            }
            
            let allCorrect = true;
            const blanks = document.querySelectorAll('.blank-input');
            
            blanks.forEach((blank, index) => {
                const userAnswer = blank.textContent.trim().toLowerCase();
                const correctAnswer = currentStory.blanks[index].word.toLowerCase();
                
                if (userAnswer === correctAnswer) {
                    blank.classList.add('correct');
                    blank.classList.remove('incorrect');
                } else {
                    blank.classList.add('incorrect');
                    blank.classList.remove('correct');
                    allCorrect = false;
                    
                    // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
                    const correctWord = document.createElement('div');
                    correctWord.textContent = `æ­£ç¡®å•è¯: ${currentStory.blanks[index].word}`;
                    correctWord.style.color = 'red';
                    correctWord.style.fontSize = '0.8rem';
                    blank.parentNode.insertBefore(correctWord, blank.nextSibling);
                }
            });
            
            if (allCorrect) {
                // æ›´æ–°åˆ†æ•°
                gameScores.game3 += 20;
                localStorage.setItem('wordGameScores', JSON.stringify(gameScores));
                
                // æ ‡è®°æ•…äº‹ä¸ºå·²å®Œæˆ
                completedStories.push(currentStory.title);
                localStorage.setItem('completedStories', JSON.stringify(completedStories));
                
                // æ˜¾ç¤ºå®ŒæˆæŒ‰é’®
                document.getElementById('story-complete-buttons').style.display = 'flex';
                
                // åœæ­¢è®¡æ—¶
                clearInterval(storyTimer);
            } else {
                alert('æœ‰äº›å¡«ç©ºä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥å¹¶ä¿®æ”¹ï¼');
            }
        }
        
        function nextStory() {
            // éšè—å®ŒæˆæŒ‰é’®
            document.getElementById('story-complete-buttons').style.display = 'none';
            
            // é‡ç½®å½“å‰æ•…äº‹
            resetCurrent();
            
            // åŠ è½½æ–°æ•…äº‹
            loadRandomStory();
            
            // é‡æ–°å¼€å§‹è®¡æ—¶
            storySeconds = 0;
            clearInterval(storyTimer);
            storyTimer = setInterval(() => {
                storySeconds++;
                document.getElementById('timer-3').textContent = storySeconds;
            }, 1000);
        }
        
        function goToFinalPage() {
            // æ›´æ–°è¿›åº¦
            updateProgress(3);
            
            // è®¡ç®—æ€»åˆ†
            let totalScore = gameScores.game1 + gameScores.game2 + gameScores.game3 + gameScores.game4;
            document.getElementById('total-score').textContent = totalScore;
            
            // æ˜¾ç¤ºç»“æŸé¡µ
            showPage('final-page');
        }
        
        function resetCurrent() {
            document.querySelectorAll('.blank-input').forEach(blank => {
                blank.textContent = '';
                blank.classList.remove('filled', 'correct', 'incorrect');
                
                // ç§»é™¤æ­£ç¡®ç­”æ¡ˆæç¤º
                const nextSibling = blank.nextSibling;
                if (nextSibling && nextSibling.textContent && nextSibling.textContent.includes('æ­£ç¡®å•è¯')) {
                    nextSibling.remove();
                }
            });
            document.getElementById('word-input').value = '';
            selectedBlankIndex = -1;
        }
        
        // ç¬¬å››å…³æ¸¸æˆé€»è¾‘ - å¥å­æ±‰è¯‘è‹±
        let translationTimer;
        let translationSeconds = 0;
        let usedSentences = [];
        let currentSentence = null;
        
        // é¢„è®¾å¥å­
        const sentences = [
            {
                english: "We need to register before attending the lecture.",
                chinese: "æˆ‘ä»¬éœ€è¦å…ˆæ³¨å†Œæ‰èƒ½å‚åŠ è®²åº§ã€‚",
                hints: "register, lecture"
            },
            {
                english: "The designer will explain his new design to us.",
                chinese: "è®¾è®¡å¸ˆå°†å‘æˆ‘ä»¬è§£é‡Šä»–çš„æ–°è®¾è®¡ã€‚",
                hints: "designer, design"
            },
            {
                english: "She feels anxious about the upcoming exam.",
                chinese: "å¥¹å¯¹å³å°†åˆ°æ¥çš„è€ƒè¯•æ„Ÿåˆ°ç„¦è™‘ã€‚",
                hints: "anxious"
            },
            {
                english: "The campus looks beautiful in spring.",
                chinese: "æ˜¥å¤©çš„æ ¡å›­çœ‹èµ·æ¥å¾ˆæ¼‚äº®ã€‚",
                hints: "campus"
            },
            {
                english: "You should wear formal clothes to the meeting.",
                chinese: "ä½ åº”è¯¥ç©¿æ­£å¼çš„è¡£æœå»å‚åŠ ä¼šè®®ã€‚",
                hints: "formal"
            },
            {
                english: "He made a good impression on his new teacher.",
                chinese: "ä»–ç»™æ–°è€å¸ˆç•™ä¸‹äº†å¾ˆå¥½çš„å°è±¡ã€‚",
                hints: "impression, impress"
            },
            {
                english: "We need to concentrate on our studies.",
                chinese: "æˆ‘ä»¬éœ€è¦é›†ä¸­ç²¾åŠ›å­¦ä¹ ã€‚",
                hints: "concentrate"
            },
            {
                english: "The scientists are doing an important experiment.",
                chinese: "ç§‘å­¦å®¶ä»¬æ­£åœ¨åšä¸€é¡¹é‡è¦çš„å®éªŒã€‚",
                hints: "experiment"
            },
            {
                english: "She is more confident than before.",
                chinese: "å¥¹æ¯”ä»¥å‰æ›´è‡ªä¿¡äº†ã€‚",
                hints: "confident"
            },
            {
                english: "We should set clear goals for our future.",
                chinese: "æˆ‘ä»¬åº”è¯¥ä¸ºæœªæ¥è®¾å®šæ˜ç¡®çš„ç›®æ ‡ã€‚",
                hints: "goal"
            },
            {
                english: "Teenagers need more care and understanding.",
                chinese: "é’å°‘å¹´éœ€è¦æ›´å¤šçš„å…³å¿ƒå’Œç†è§£ã€‚",
                hints: "teenager, teenage"
            },
            {
                english: "He wants to improve his English speaking skills.",
                chinese: "ä»–æƒ³æé«˜è‡ªå·±çš„è‹±è¯­å£è¯­èƒ½åŠ›ã€‚",
                hints: "improve"
            },
            {
                english: "She is curious about how things work.",
                chinese: "å¥¹å¯¹äº‹ç‰©çš„è¿ä½œæ–¹å¼æ„Ÿåˆ°å¥½å¥‡ã€‚",
                hints: "curious"
            },
            {
                english: "They will organise a volunteer activity next week.",
                chinese: "ä»–ä»¬ä¸‹å‘¨å°†ç»„ç»‡ä¸€æ¬¡å¿—æ„¿è€…æ´»åŠ¨ã€‚",
                hints: "organise, volunteer"
            },
            {
                english: "Different people have different personalities.",
                chinese: "ä¸åŒçš„äººæœ‰ä¸åŒçš„æ€§æ ¼ã€‚",
                hints: "personality"
            }
        ];
        
        function startTranslationGame() {
            usedSentences = JSON.parse(localStorage.getItem('usedSentences') || '[]');
            
            // å¼€å§‹è®¡æ—¶
            translationSeconds = 0;
            clearInterval(translationTimer);
            translationTimer = setInterval(() => {
                translationSeconds++;
                document.getElementById('timer-4').textContent = translationSeconds;
            }, 1000);
            
            // æ¸…ç©ºç»“æœåŒºåŸŸ
            document.getElementById('result-area').innerHTML = '';
            document.getElementById('translation-input').value = '';
            
            // å¼€å§‹æ–°å¥å­
            startNewSentence();
        }
        
        function startNewSentence() {
            // è¿‡æ»¤å·²ä½¿ç”¨çš„å¥å­
            const availableSentences = sentences.filter(item => !usedSentences.includes(item.chinese));
            
            if (availableSentences.length === 0) {
                alert('æ‰€æœ‰å¥å­éƒ½å·²ä½¿ç”¨ï¼é‡ç½®è¿›åº¦ä»¥é‡æ–°å¼€å§‹ã€‚');
                clearInterval(translationTimer);
                return;
            }
            
            // éšæœºé€‰æ‹©ä¸€ä¸ªå¥å­
            const randomIndex = Math.floor(Math.random() * availableSentences.length);
            currentSentence = availableSentences[randomIndex];
            
            // æ›´æ–°ä¸­æ–‡å¥å­å’Œæç¤ºè¯
            document.getElementById('chinese-sentence').textContent = currentSentence.chinese;
            document.getElementById('hint-words').textContent = `æç¤ºè¯: ${currentSentence.hints}`;
            
            // æ¸…ç©ºè¾“å…¥æ¡†å’Œç»“æœåŒºåŸŸ
            document.getElementById('translation-input').value = '';
            document.getElementById('result-area').innerHTML = '';
        }
        
        function checkTranslation() {
            if (!currentSentence) {
                alert('è¯·å…ˆå¼€å§‹æŒ‘æˆ˜ï¼');
                return;
            }
            
            const userTranslation = document.getElementById('translation-input').value.trim();
            if (!userTranslation) {
                alert('è¯·è¾“å…¥è‹±æ–‡ç¿»è¯‘ï¼');
                return;
            }
            
            // ç®€å•çš„ç­”æ¡ˆæ£€æŸ¥ï¼ˆå¿½ç•¥å¤§å°å†™å’Œæ ‡ç‚¹ç¬¦å·ï¼‰
            const userAnswer = userTranslation.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g, "");
            const correctAnswer = currentSentence.english.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g, "");
            
            const resultArea = document.getElementById('result-area');
            
            if (userAnswer === correctAnswer) {
                // ç­”æ¡ˆæ­£ç¡®
                resultArea.innerHTML = `<div class="correct-translation">âœ“ ç¿»è¯‘æ­£ç¡®ï¼</div>`;
                
                // æ›´æ–°åˆ†æ•°
                gameScores.game4 += 15;
                localStorage.setItem('wordGameScores', JSON.stringify(gameScores));
                
                // æ ‡è®°å¥å­ä¸ºå·²ä½¿ç”¨
                usedSentences.push(currentSentence.chinese);
                localStorage.setItem('usedSentences', JSON.stringify(usedSentences));
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆä¸€è½®ï¼ˆ5ä¸ªå¥å­ï¼‰
                if (usedSentences.length % 5 === 0) {
                    setTimeout(() => {
                        alert(`æ­å–œï¼ä½ å·²å®Œæˆä¸€è½®ï¼ˆ5ä¸ªå¥å­ï¼‰ï¼ç”¨æ—¶ï¼š${translationSeconds}ç§’`);
                    }, 1000);
                }
                
                // è¿›å…¥ä¸‹ä¸€ä¸ªå¥å­
                setTimeout(() => {
                    startNewSentence();
                }, 1500);
            } else {
                // ç­”æ¡ˆé”™è¯¯
                resultArea.innerHTML = `
                    <div class="incorrect-translation">âœ— ç¿»è¯‘ä¸æ­£ç¡®</div>
                    <div class="correct-translation">æ­£ç¡®ç­”æ¡ˆ: ${currentSentence.english}</div>
                `;
                
                // å…è®¸ç”¨æˆ·é‡è¯•
                setTimeout(() => {
                    document.getElementById('translation-input').focus();
                }, 100);
            }
        }
        
        function clearTranslation() {
            document.getElementById('translation-input').value = '';
            document.getElementById('result-area').innerHTML = '';
        }
        
        function skipSentence() {
            if (!currentSentence) {
                alert('è¯·å…ˆå¼€å§‹æŒ‘æˆ˜ï¼');
                return;
            }
            
            document.getElementById('result-area').innerHTML = `
                <div class="correct-translation">æ­£ç¡®ç­”æ¡ˆ: ${currentSentence.english}</div>
            `;
            
            // æ ‡è®°å¥å­ä¸ºå·²ä½¿ç”¨
            usedSentences.push(currentSentence.chinese);
            localStorage.setItem('usedSentences', JSON.stringify(usedSentences));
            
            // è¿›å…¥ä¸‹ä¸€ä¸ªå¥å­
            setTimeout(() => {
                startNewSentence();
            }, 2000);
        }
        
        // ç¬¬äºŒå…³æ¸¸æˆé€»è¾‘
        // æ¸¸æˆçŠ¶æ€å˜é‡
        let wordList = [];
        let currentWordSet = [];
        let wordIndex = 0;
        let gameStarted = false;
        let gamePaused = false;
        let timerInterval;
        let seconds = 0;
        let speed = 1; // 1: æ™®é€š, 2: ä¸­é€Ÿ, 3: å¿«é€Ÿ
        let wordInterval;
        let stackedWords = [];
        let wordsFalling = false;
        let currentActiveWord = null; // å½“å‰æ´»åŠ¨çš„å•è¯
        let waitingForUser = false; // æ˜¯å¦æ­£åœ¨ç­‰å¾…ç”¨æˆ·å¤„ç†
        let lastCorrectIndex = -1; // æ–°å¢ï¼šè®°å½•ä¸Šä¸€æ¬¡æ­£ç¡®ä½ç½®

        // DOMå…ƒç´ 
        const gameTitleEl = document.getElementById('gameTitle');
        const speedSlider = document.getElementById('speedSlider');
        const importBtn = document.getElementById('importBtn');
        const wordFile = document.getElementById('wordFile');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const exitBtn = document.getElementById('exitBtn');
        const timerEl = document.getElementById('timer');
        const wordPanel = document.getElementById('wordPanel');
        const geeseArea = document.getElementById('geeseArea');
        const resultModal = document.getElementById('resultModal');
        const resultText = document.getElementById('resultText');
        const timeUsed = document.getElementById('timeUsed');
        const continueBtn = document.getElementById('continueBtn');
        const meaning0 = document.getElementById('meaning0');
        const meaning1 = document.getElementById('meaning1');
        const meaning2 = document.getElementById('meaning2');
        const waitingIndicator = document.getElementById('waitingIndicator');

        // ä»localStorageåŠ è½½æ•°æ®
        function loadFromStorage() {
            const savedTitle = localStorage.getItem('wordGooseTitle');
            if (savedTitle) {
                gameTitleEl.textContent = savedTitle;
            }
            
            const savedWordList = localStorage.getItem('wordGooseWordList');
            if (savedWordList) {
                wordList = JSON.parse(savedWordList);
                if (wordList.length > 0) {
                    updateMeanings();
                }
            }
        }

        // ä¿å­˜æ•°æ®åˆ°localStorage
        function saveToStorage() {
            localStorage.setItem('wordGooseTitle', gameTitleEl.textContent);
            localStorage.setItem('wordGooseWordList', JSON.stringify(wordList));
        }

        // ç‚¹å‡»æ ‡é¢˜å¯ç¼–è¾‘
        gameTitleEl.addEventListener('click', function() {
            const currentTitle = this.textContent;
            this.innerHTML = `<input type="text" value="${currentTitle}" style="font-size: inherit; border: none; background: transparent; text-align: center; width: 100%;">`;
            const input = this.querySelector('input');
            input.focus();
            input.select();
            
            input.addEventListener('blur', function() {
                gameTitleEl.textContent = this.value || 'å•è¯æŠ“å¤§é¹…';
                saveToStorage();
            });
            
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    this.blur();
                }
            });
        });

        // é€Ÿåº¦æ»‘å—æ§åˆ¶
        speedSlider.addEventListener('input', function() {
            speed = parseInt(this.value);
            if (gameStarted && !gamePaused) {
                clearInterval(wordInterval);
                startWordFalling();
            }
        });

        // å¯¼å…¥å•è¯è¡¨
        importBtn.addEventListener('click', function() {
            wordFile.click();
        });

        wordFile.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const data = event.target.result;
                // ç®€å•è§£æCSVæ ¼å¼
                const lines = data.split('\n');
                wordList = [];
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    // å‡è®¾æ ¼å¼ä¸º: å•è¯,é‡Šä¹‰
                    const parts = line.split(',');
                    if (parts.length >= 2) {
                        wordList.push({
                            word: parts[0].trim(),
                            meaning: parts[1].trim()
                        });
                    }
                }
                
                if (wordList.length > 0) {
                    // æ‰“ä¹±å•è¯é¡ºåº
                    shuffleArray(wordList);
                    updateMeanings();
                    saveToStorage();
                    alert(`æˆåŠŸå¯¼å…¥ ${wordList.length} ä¸ªå•è¯ï¼`);
                } else {
                    alert('æœªèƒ½æˆåŠŸå¯¼å…¥å•è¯ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼');
                }
            };
            
            reader.readAsText(file);
        });

        // å¼€å§‹/é‡æ–°å¼€å§‹æ¸¸æˆ
        startBtn.addEventListener('click', function() {
            if (wordList.length === 0) {
                alert('è¯·å…ˆä¸Šä¼ å•è¯è¡¨ï¼');
                return;
            }
            
            if (gameStarted) {
                // é‡æ–°å¼€å§‹
                resetGame();
            }
            
            gameStarted = true;
            gamePaused = false;
            startBtn.textContent = 'é‡æ–°å¼€å§‹ï¼ˆé‡ç½®è¯æ±‡ï¼‰';
            pauseBtn.disabled = false;
            
            // é‡ç½®å•è¯ç´¢å¼•
            wordIndex = 0;
            currentWordSet = getNextWordSet();
            updateMeanings();
            
            // å¼€å§‹è®¡æ—¶
            startTimer();
            
            // å¼€å§‹å•è¯ä¸‹è½
            startWordFalling();
        });

        // æš‚åœæ¸¸æˆ
        pauseBtn.addEventListener('click', function() {
            if (!gameStarted) return;
            
            gamePaused = !gamePaused;
            pauseBtn.textContent = gamePaused ? 'ç»§ç»­' : 'æš‚åœ';
            
            if (gamePaused) {
                clearInterval(timerInterval);
                clearInterval(wordInterval);
            } else {
                startTimer();
                startWordFalling();
            }
        });

        // é€€å‡ºæ¸¸æˆ
        exitBtn.addEventListener('click', function() {
            resetGame();
            wordPanel.innerHTML = '';
            stackedWords = [];
            startBtn.textContent = 'å¼€å§‹æ¸¸æˆ';
            pauseBtn.disabled = true;
            backToCover();
        });

        // ç»§ç»­æŒ‘æˆ˜
        continueBtn.addEventListener('click', function() {
            resultModal.style.display = 'none';
            wordIndex += 20;
            currentWordSet = getNextWordSet();
            updateMeanings();
            startWordFalling();
        });

        // è·å–ä¸‹ä¸€ç»„å•è¯
        function getNextWordSet() {
            const start = wordIndex;
            const end = Math.min(wordIndex + 20, wordList.length);
            const set = wordList.slice(start, end);
            
            // å¦‚æœå•è¯ä¸è¶³ï¼Œä»å¤´å¼€å§‹
            if (set.length < 20 && wordList.length > 0) {
                const remaining = 20 - set.length;
                set.push(...wordList.slice(0, remaining));
                wordIndex = remaining;
            } else {
                wordIndex = end;
            }
            
            return set;
        }

        // æ›´æ–°å¤§é¹…æ¡†ä¸­çš„é‡Šä¹‰
        function updateMeanings() {
            if (currentWordSet.length === 0) return;
            
            // è·å–å½“å‰å•è¯çš„æ­£ç¡®é‡Šä¹‰
            const currentWord = currentWordSet[0];
            if (!currentWord) return;
            
            const correctMeaning = currentWord.meaning;
            
            // è·å–ä¸¤ä¸ªé”™è¯¯çš„é‡Šä¹‰
            const wrongMeanings = [];
            while (wrongMeanings.length < 2) {
                const randomIndex = Math.floor(Math.random() * wordList.length);
                const randomWord = wordList[randomIndex];
                if (randomWord.meaning !== correctMeaning && 
                    !wrongMeanings.includes(randomWord.meaning)) {
                    wrongMeanings.push(randomWord.meaning);
                }
            }
            
            // éšæœºæ’åˆ—ä¸‰ä¸ªé‡Šä¹‰çš„ä½ç½®ï¼Œä½†ç¡®ä¿æ­£ç¡®ä½ç½®ä¸ä¸Šä¸€æ¬¡ä¸åŒ
            let availablePositions = [0, 1, 2];
            
            // å¦‚æœè¿™ä¸æ˜¯ç¬¬ä¸€æ¬¡ï¼Œæ’é™¤ä¸Šä¸€æ¬¡çš„æ­£ç¡®ä½ç½®
            if (lastCorrectIndex !== -1) {
                availablePositions = availablePositions.filter(pos => pos !== lastCorrectIndex);
            }
            
            // ä»å¯ç”¨çš„ä½ç½®ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªä½œä¸ºæ­£ç¡®ä½ç½®
            const correctPosition = availablePositions[Math.floor(Math.random() * availablePositions.length)];
            lastCorrectIndex = correctPosition; // è®°å½•è¿™æ¬¡çš„æ­£ç¡®ä½ç½®
            
            // åˆ›å»ºåŒ…å«æ‰€æœ‰é‡Šä¹‰çš„æ•°ç»„ï¼Œå…ˆå¡«å……ç©ºå€¼
            const allMeanings = new Array(3).fill(null);
            
            // åœ¨æ­£ç¡®ä½ç½®æ”¾ç½®æ­£ç¡®é‡Šä¹‰
            allMeanings[correctPosition] = correctMeaning;
            
            // åœ¨å‰©ä½™ä½ç½®æ”¾ç½®é”™è¯¯é‡Šä¹‰
            let wrongIndex = 0;
            for (let i = 0; i < 3; i++) {
                if (allMeanings[i] === null) {
                    allMeanings[i] = wrongMeanings[wrongIndex];
                    wrongIndex++;
                }
            }
            
            // æ›´æ–°å¤§é¹…æ¡†
            meaning0.textContent = allMeanings[0];
            meaning1.textContent = allMeanings[1];
            meaning2.textContent = allMeanings[2];
            
            // å­˜å‚¨æ­£ç¡®é‡Šä¹‰çš„ä½ç½®
            geeseArea.dataset.correctIndex = correctPosition;
        }

        // å¼€å§‹è®¡æ—¶
        function startTimer() {
            seconds = 0;
            timerEl.textContent = `è€—æ—¶ï¼š${seconds}ç§’`;
            clearInterval(timerInterval);
            timerInterval = setInterval(function() {
                if (!gamePaused) {
                    seconds++;
                    timerEl.textContent = `è€—æ—¶ï¼š${seconds}ç§’`;
                }
            }, 1000);
        }

        // å¼€å§‹å•è¯ä¸‹è½
        function startWordFalling() {
            clearInterval(wordInterval);
            
            let intervalTime;
            switch(speed) {
                case 1: intervalTime = 3000; break; // æ™®é€š
                case 2: intervalTime = 1800; break; // ä¸­é€Ÿ
                case 3: intervalTime = 1000; break; // å¿«é€Ÿ
            }
            
            wordInterval = setInterval(function() {
                if (!gamePaused && currentWordSet.length > 0 && !waitingForUser) {
                    createWordBox();
                }
            }, intervalTime);
            
            // ç«‹å³å¼€å§‹ç¬¬ä¸€ä¸ªå•è¯ä¸‹è½
            wordsFalling = true;
            if (currentWordSet.length > 0 && !waitingForUser) {
                createWordBox();
            }
        }

        // åˆ›å»ºå•è¯æ–¹å—
        function createWordBox() {
            if (currentWordSet.length === 0 || waitingForUser) return;
            
            const wordData = currentWordSet[0];
            if (!wordData) return;
            
            const wordBox = document.createElement('div');
            wordBox.className = 'word-box';
            wordBox.textContent = wordData.word;
            wordBox.dataset.word = wordData.word;
            wordBox.dataset.meaning = wordData.meaning;
            
            // éšæœºæ°´å¹³ä½ç½®ï¼Œç¡®ä¿åœ¨é¢æ¿å†…
            const maxLeft = wordPanel.offsetWidth - 120;
            const left = Math.max(10, Math.min(maxLeft, Math.random() * maxLeft));
            wordBox.style.left = `${left}px`;
            wordBox.style.top = '0px';
            
            // æ·»åŠ æ‹–æ‹½åŠŸèƒ½
            wordBox.draggable = true;
            wordBox.addEventListener('dragstart', handleDragStart);
            
            wordPanel.appendChild(wordBox);
            
            // è®¾ç½®å½“å‰æ´»åŠ¨å•è¯
            currentActiveWord = wordBox;
            waitingForUser = true;
            waitingIndicator.style.display = 'block';
            
            // åŠ¨ç”»ä¸‹è½
            let topPos = 0;
            const fallInterval = setInterval(function() {
                if (gamePaused) return;
                
                topPos += 2;
                wordBox.style.top = `${topPos}px`;
                
                // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾åº•éƒ¨
                if (topPos >= wordPanel.offsetHeight - 40) {
                    clearInterval(fallInterval);
                    
                    // å¦‚æœå•è¯æ²¡æœ‰åœ¨æ­£ç¡®ä½ç½®è¢«æ‹–æ‹½ï¼Œå°†å…¶å †å åœ¨åº•éƒ¨
                    if (wordBox.parentNode) {
                        wordBox.classList.remove('word-box');
                        wordBox.classList.add('stacked-word');
                        wordBox.style.top = 'auto';
                        wordBox.style.bottom = `${stackedWords.length * 40}px`;
                        stackedWords.push(wordBox);
                        
                        // å•è¯å †å åï¼Œå…è®¸ä¸‹ä¸€ä¸ªå•è¯ä¸‹è½
                        currentActiveWord = null;
                        waitingForUser = false;
                        waitingIndicator.style.display = 'none';
                    }
                }
            }, 20);
        }

        // å¤„ç†æ‹–æ‹½å¼€å§‹
        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.word);
            e.target.classList.add('dragging');
        }

        // å¤„ç†æ‹–æ‹½ç»“æŸ
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        // å¤„ç†æ‹–æ‹½æ”¾ç½®
        function handleDrop(e) {
            e.preventDefault();
            const word = e.dataTransfer.getData('text/plain');
            const gooseBox = e.currentTarget;
            const gooseIndex = parseInt(gooseBox.dataset.index);
            const correctIndex = parseInt(geeseArea.dataset.correctIndex);
            
            // æ£€æŸ¥æ˜¯å¦åŒ¹é…
            if (gooseIndex === correctIndex) {
                // åŒ¹é…æ­£ç¡®
                gooseBox.classList.add('correct');
                createFireworks(gooseBox);
                
                // ç§»é™¤å•è¯
                const wordBoxes = document.querySelectorAll('.word-box, .stacked-word');
                for (let box of wordBoxes) {
                    if (box.dataset.word === word) {
                        box.style.transition = 'all 0.5s';
                        box.style.transform = 'scale(0)';
                        setTimeout(() => {
                            if (box.parentNode) {
                                box.parentNode.removeChild(box);
                            }
                        }, 500);
                        break;
                    }
                }
                
                // ä»å †å å•è¯ä¸­ç§»é™¤
                stackedWords = stackedWords.filter(box => box.dataset.word !== word);
                
                // æ›´æ–°å †å å•è¯ä½ç½®
                updateStackedWords();
                
                // ç§»é™¤å½“å‰å•è¯å¹¶è·å–ä¸‹ä¸€ä¸ª
                currentWordSet.shift();
                
                // å•è¯è¢«å¤„ç†åï¼Œå…è®¸ä¸‹ä¸€ä¸ªå•è¯ä¸‹è½
                currentActiveWord = null;
                waitingForUser = false;
                waitingIndicator.style.display = 'none';
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆä¸€è½®
                if (currentWordSet.length === 0) {
                    clearInterval(wordInterval);
                    clearInterval(timerInterval);
                    timeUsed.textContent = seconds;
                    resultModal.style.display = 'flex';
                    gameStarted = false;
                    startBtn.textContent = 'å¼€å§‹æ¸¸æˆ';
                    pauseBtn.disabled = true;
                    
                    // æ›´æ–°åˆ†æ•°
                    gameScores.game2 += 20;
                    localStorage.setItem('wordGameScores', JSON.stringify(gameScores));
                } else {
                    // æ›´æ–°å¤§é¹…æ¡†ä¸­çš„é‡Šä¹‰
                    setTimeout(() => {
                        gooseBox.classList.remove('correct');
                        updateMeanings();
                    }, 1000);
                }
            } else {
                // åŒ¹é…é”™è¯¯
                gooseBox.classList.add('wrong');
                
                // é«˜äº®æ­£ç¡®çš„é‡Šä¹‰æ¡†
                const correctGoose = document.querySelector(`.goose-box[data-index="${correctIndex}"]`);
                correctGoose.classList.add('highlight');
                
                setTimeout(() => {
                    gooseBox.classList.remove('wrong');
                    correctGoose.classList.remove('highlight');
                }, 1500);
            }
        }

        // æ›´æ–°å †å å•è¯çš„ä½ç½®
        function updateStackedWords() {
            for (let i = 0; i < stackedWords.length; i++) {
                stackedWords[i].style.bottom = `${i * 40}px`;
            }
        }

        // åˆ›å»ºçƒŸèŠ±ç‰¹æ•ˆ
        function createFireworks(container) {
            const rect = container.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            for (let i = 0; i < 30; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.backgroundColor = getRandomColor();
                firework.style.left = `${centerX}px`;
                firework.style.top = `${centerY}px`;
                
                document.body.appendChild(firework);
                
                // éšæœºæ–¹å‘
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 100;
                const targetX = centerX + Math.cos(angle) * distance;
                const targetY = centerY + Math.sin(angle) * distance;
                
                // åŠ¨ç”»
                firework.animate([
                    { transform: 'translate(0, 0)', opacity: 1 },
                    { transform: `translate(${targetX - centerX}px, ${targetY - centerY}px)`, opacity: 0 }
                ], {
                    duration: 1000,
                    easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)',
                    fill: 'forwards'
                });
                
                // ç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    if (firework.parentNode) {
                        firework.parentNode.removeChild(firework);
                    }
                }, 1000);
            }
        }

        // è·å–éšæœºé¢œè‰²
        function getRandomColor() {
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            gameStarted = false;
            gamePaused = false;
            clearInterval(timerInterval);
            clearInterval(wordInterval);
            seconds = 0;
            timerEl.textContent = `è€—æ—¶ï¼š${seconds}ç§’`;
            wordPanel.innerHTML = '';
            stackedWords = [];
            pauseBtn.textContent = 'æš‚åœ';
            currentActiveWord = null;
            waitingForUser = false;
            waitingIndicator.style.display = 'none';
            
            // é‡ç½®ä¸Šä¸€æ¬¡æ­£ç¡®ä½ç½®
            lastCorrectIndex = -1;
            
            // é‡æ–°æ‰“ä¹±å•è¯åˆ—è¡¨
            if (wordList.length > 0) {
                shuffleArray(wordList);
                wordIndex = 0;
                currentWordSet = getNextWordSet();
                updateMeanings();
            }
        }

        // åˆå§‹åŒ–æ‹–æ”¾äº‹ä»¶
        function initDragAndDrop() {
            const gooseBoxes = document.querySelectorAll('.goose-box');
            gooseBoxes.forEach(box => {
                box.addEventListener('dragover', function(e) {
                    e.preventDefault();
                });
                
                box.addEventListener('drop', handleDrop);
            });
            
            // æ·»åŠ å…¨å±€æ‹–æ‹½ç»“æŸäº‹ä»¶
            document.addEventListener('dragend', handleDragEnd);
        }

        // é€šç”¨å·¥å…·å‡½æ•°
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // åˆå§‹åŒ–ç¬¬äºŒå…³
        function initGame2() {
            loadFromStorage();
            initDragAndDrop();
        }

        // åˆå§‹åŒ–é¡µé¢
        showPage('cover-page');
        
        // åˆå§‹åŒ–ç¬¬äºŒå…³
        initGame2();
    </script>
</body>
</html>